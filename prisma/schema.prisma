// This is your Prisma schema file,
// learn more about it in the docs: https://pris.ly/d/prisma-schema

// Looking for ways to speed up your queries, or scale easily with your serverless or edge functions?
// Try Prisma Accelerate: https://pris.ly/cli/accelerate-init

generator client {
  provider = "prisma-client-js"
  output   = "../generated/prisma"
}

datasource db {
  provider = "postgresql"
}

model User{
  id String @id @default(uuid())
  publicId String @unique  @default(dbgenerated("concat('user_', gen_random_uuid())"))

  email String @unique
  passwordHash String

  referralCode String @unique @default(dbgenerated("concat('ref_', substr(gen_random_uuid()::text, 1, 8))"))
  
  name String?
  avatar String?
  dob DateTime?

  instituteName String?

  registrations ReferralRegistered[]


  createdAt DateTime @default(now())
  updatedAt DateTime @updatedAt

  @@index([publicId])
  @@index([email])
  @@index([referralCode])
}


model ReferralRegistered {
  id String @id @default(uuid())

  referralCode String
  referralCodeHolder User @relation(fields: [referralCode], references: [referralCode])

  doneByIdentifier String

  createdAt DateTime @default(now())
  updatedAt DateTime @updatedAt
  @@unique([referralCode, doneByIdentifier])
  @@index([referralCode])
}



enum AssetType{
  IMAGE 
  VIDEO
}
model Post{
  id String @id @default(uuid())
  publicId String @unique  @default(dbgenerated("concat('post_', gen_random_uuid())"))
  slug String @unique

  title String @db.Text
  summary String @db.Text
  contentHTML String @db.Text
  
  assets PostAsset[]

  sharableLink String @unique

  isPublished Boolean @default(true)
  isArchived Boolean @default(false)
  isDeleted Boolean @default(false)

  lastUpdatedById String 

  lastUpdatedBy AdminUser @relation(fields: [lastUpdatedById],references: [id])

  createdAt DateTime @default(now())
  updatedAt DateTime @updatedAt

  @@index([slug])
  @@index([publicId])
  @@index([isArchived])
  @@index([isPublished])
}


model PostAsset{
  id String @id @default(uuid())
  postId String 
  post Post @relation(fields: [postId],references: [id])
  url String
  thumbnail String
  type AssetType @default(IMAGE)
}

model AdminUser{
  id String @id @default(uuid())
  email String @unique
  passwordHash String

  lastUpdatedPost Post[]
  createdAt DateTime @default(now())
  updatedAt DateTime @updatedAt

  @@index([email])
}
